<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹model_closed.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹model_closed.ML›</h1>
</div>

<pre class="source"><span class="comment1">(*fun mclosed i t = case fastype_of t of 
       typ as Type ("fun",[u,_]) =&gt; 
        if body_type typ = @{typ bool} then HOLogic.mk_Trueprop @{term True} else
          let val varx = (Var (("x",i), u)) 
          in Logic.all_const u $ lambda varx
             (@{term Pure.imp} $ (mclosed (i+1) varx) $ (mclosed (i+1) (t $ varx))) end
     | @{typ 'd} =&gt;  HOLogic.mk_Trueprop (@{term inModel} $ t)
     | @{typ bool} =&gt; HOLogic.mk_Trueprop @{term True}
     | _ =&gt; error "weird type!"*)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mclosed</span> <span class="entity">i</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> fastype_of <span class="entity">t</span> <span class="keyword2"><span class="keyword">of</span></span> 
       <span class="entity">typ</span> <span class="keyword1"><span class="keyword">as</span></span> Type <span class="main">(</span><span class="inner_quoted">"fun"</span><span class="main">,</span><span class="main">[</span><span class="entity">u</span><span class="main">,</span><span class="main">_</span><span class="main">]</span><span class="main">)</span> <span class="main">=&gt;</span> 
        <span class="keyword2"><span class="keyword">if</span></span> body_type <span class="entity">typ</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">bool</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">HOLogic.mk_Trueprop</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">True</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">else</span></span>
          <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">varx</span> <span class="main">=</span> <span class="main">(</span>Var <span class="main">(</span><span class="main">(</span><span class="inner_quoted">"x"</span><span class="main">,</span><span class="entity">i</span><span class="main">)</span><span class="main">,</span> <span class="entity">u</span><span class="main">)</span><span class="main">)</span> 
          <span class="keyword2"><span class="keyword">in</span></span> Logic.all_const <span class="entity">u</span> $ lambda <span class="entity">varx</span>
             <span class="main">(</span><span class="entity">mclosed</span> <span class="main">(</span><span class="entity">i</span>+<span class="inner_numeral">1</span><span class="main">)</span> <span class="main">(</span><span class="entity">t</span> $ <span class="entity">varx</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span>
     <span class="main">|</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted"><span class="tfree">'d</span></span><span class="antiquote">}</span></span> <span class="main">=&gt;</span>  <span class="entity">HOLogic.mk_Trueprop</span> <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">inModel</span><span class="antiquote">}</span></span> $ <span class="entity">t</span><span class="main">)</span>
     <span class="main">|</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">bool</span><span class="antiquote">}</span></span> <span class="main">=&gt;</span> <span class="entity">HOLogic.mk_Trueprop</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">True</span><span class="antiquote">}</span></span>
     <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> error <span class="inner_quoted">"weird type!"</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">before_qed</span> <span class="main">=</span> SOME <span class="main">(</span><span class="entity">Method.Basic</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> 
  <span class="main">(</span><span class="entity">SIMPLE_METHOD</span> <span class="main">(</span><span class="entity">simp_tac</span> <span class="main">(</span>put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="inner_numeral">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">model_closed_cmd</span> <span class="main">(</span><span class="entity">thm_name</span><span class="main">,</span> <span class="entity">src</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">mdl</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="entity">msig</span> <span class="main">{</span><span class="entity">name</span><span class="main">,</span> <span class="entity">target</span><span class="main">,</span> <span class="entity">sigmap</span><span class="main">}</span> <span class="main">=</span> <span class="entity">src_to_model</span> <span class="entity">src</span> <span class="entity">ctxt</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">mconsts</span> <span class="main">=</span> <span class="entity">get_mconsts</span> <span class="entity">mdl</span> <span class="entity">ctxt</span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">props</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">mclosed</span> <span class="inner_numeral">0</span><span class="main">)</span> <span class="entity">mconsts</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">goals</span> <span class="main">=</span> filter <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">p</span> <span class="main">=&gt;</span> not <span class="main">(</span><span class="entity">p</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">prop</span> <span class="quoted">"True"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">)</span> <span class="entity">props</span>
  <span class="keyword2"><span class="keyword">in</span></span> 
    <span class="entity">Proof.theorem</span> NONE <span class="main">(</span><span class="entity">after_qed</span> <span class="entity">thm_name</span><span class="main">)</span> <span class="main">[</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">t</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">t</span><span class="main">,</span><span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="entity">goals</span><span class="main">]</span> <span class="entity">ctxt</span> 
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="entity">Outer_Syntax.local_theory_to_proof</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">command_keyword</span> "<span class="keyword1">model_closed</span>"<span class="antiquote">}</span></span></span>
        <span class="inner_quoted">"sets up proof state for showing model is closed under a sequence of constants"</span> 
        <span class="main">(</span><span class="entity">Parse_Spec.opt_thm_name</span> <span class="inner_quoted">":"</span> -- Parse.ML_source &gt;&gt; <span class="entity">model_closed_cmd</span><span class="main">)</span> </pre>
</body>

</html>